<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Users</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<div class="sidenav" id="sidenav">
    <div class="sidebar-header">
        <img src="Library.png" alt="Library.png" class="logo" style="width: 100px; height: auto;">
        <span class="library-name">System Library</span>
    </div>
    <a href="#" onclick="openPage('manageUsers')">Manage Users</a>
    <a href="/admin/users/list">Add a book</a>
    <a href="/admin/books/list">List of Books</a>
    <a href="#" onclick="openPage('issueBook')">Issue Book</a>
    <a href="#" onclick="openPage('listIssuedBooks')">List Issued Books</a>
    <a href="#" onclick="openPage('returnBooksToday')">Books to be Returned Today</a>
</div>

<div class="main-content" id="main-content">
    <!-- Content will be loaded dynamically -->
</div>

<script>
    function openPage(pageName) {
        var mainContent = document.getElementById("main-content");
        switch (pageName) {
            case 'manageUsers':
                loadManageUsers(mainContent);
                break;
            case 'addBook':
                loadAddBookForm(mainContent);
                break;
            case 'listBooks':
                loadListBooks(mainContent);
                break;
            case 'issueBook':
                loadIssueBookForm(mainContent);
                break;
            case 'listIssuedBooks':
                loadListIssuedBooks(mainContent);
                break;
            case 'returnBooksToday':
                loadBooksToBeReturnedToday(mainContent);
                break;
        }
    }

    function loadManageUsers(mainContent) {
        fetch('/admin/users/list') // Adjust the endpoint to fetch users from your backend
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch users.');
                }
                return response.json();
            })
            .then(users => {
                mainContent.innerHTML = `
                    <div class="container">
                        <h2>Manage Users</h2>
                        <button class="form-button" onclick="addNewUser()">Add New User</button>
                        <table class="results-table" id="resultsTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email Address</th>
            <th>Phone number</th>
            <th>Date of Birth</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user : ${users}">
            <td th:text=${user.id}>ID</td>
            <td th:text=${user.name}>ID</td>
            <td th:text=${user.emailAddress}>ID</td>
            <td th:text=${user.phoneNumber}>ID</td>
            <td th:text=${user.DateOfBirth}>ID</td>
            <td>
                    <button class="small-button" onclick="editUser(${user.id})">Edit</button>
                    <button class="small-button" onclick="deleteUser(${user.id})">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>

            })
            .catch(error => {
                console.error('Error fetching users:', error);
                alert('wtf!!!!!!');
            });
    }

    function generateUsersTable(users) {
        <tr th:each="user : ${users}">
            <tr>
                <td th:text=${user.id}>ID</td>
                <td th:text=${user.name}>ID</td>
                <td th:text=${user.emailAddress}>ID</td>
                <td th:text=${user.phoneNumber}>ID</td>
                <td th:text=${user.DateOfBirth}>ID</td>
                <td>
                    <button class="small-button" onclick="editUser(${user.id})">Edit</button>
                    <button class="small-button" onclick="deleteUser(${user.id})">Delete</button>
                </td>
            </tr>
        `).join('');
    }

    function addNewUser() {
        var mainContent = document.getElementById("main-content");
        mainContent.innerHTML = `
            <div class="container">
                <h2>Add New User</h2>
                <form id="addUserForm" method="post" action="/admin/users/add">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required><br>

                    <label for="idNumber">ID Number:</label>
                    <input type="text" id="idNumber" name="idNumber" required><br>

                    <label for="dateOfBirth">Date of Birth:</label>
                    <input type="date" id="dateOfBirth" name="dateOfBirth" required><br>

                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address" required><br>

                    <label for="phoneNumber">Phone Number:</label>
                    <input type="text" id="phoneNumber" name="phoneNumber" required><br>

                    <label for="emailAddress">Email Address:</label>
                    <input type="email" id="emailAddress" name="emailAddress" required><br>

                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" required><br>

                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" required><br>

                    <label for="confirmPassword">Confirm Password:</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required><br>

                    <label for="role">Role:</label>
                    <input type="text" id="role" name="role" required><br>

                    <button type="submit" class="form-button">Add User</button>
                </form>
            </div>
        `;

        // Handle form submission
        document.getElementById('addUserForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            // Gather form data
            var formData = new FormData(event.target);

            // Send POST request to add user
            fetch(event.target.action, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    // Reload manage users page after successful addition
                    loadManageUsers(document.getElementById('main-content'));
                } else {
                    throw new Error('Failed to add user.');
                }
            })
            .catch(error => {
                console.error('Error adding user:', error);
                alert('Failed to add user. Please try again.');
            });
        });
    }

    function editUser(userId) {
        // Implement logic to edit a user
        alert("Functionality to edit user with ID: " + userId);
    }

    function deleteUser(userId) {
        // Implement logic to delete a user
        alert("Functionality to delete user with ID: " + userId);
    }
</script>

</body>
</html>
