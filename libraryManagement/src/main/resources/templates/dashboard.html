<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Side Navigation</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<div class="sidenav" id="sidenav">
    <div class="sidebar-header">
        <img src="Library.png" alt="Library.png" class="logo" style="width: 100px; height: auto;">
        <span class="library-name">System Library</span>
    </div>
    <a href="/admin/">Manage Users</a>
    <a href="#" onclick="openPage('addBook')">Add a book</a>
    <a href="/admin/books/list">List of Books</a>
    <a href="#" onclick="openPage('issueBook')">Issue Book</a>
    <a href="#" onclick="openPage('listIssuedBooks')">List Issued Books</a>
    <a href="#" onclick="openPage('returnBooksToday')">Books to be Returned Today</a>
</div>

<div class="main-content" id="main-content">
</div>

<div id="search-results"></div>



<script>

    function openPage(pageName) {
        var mainContent = document.getElementById("main-content");
        switch (pageName) {
            case 'manageUsers':
            loadManageUsers(mainContent);
            break;
            case 'addBook':
                loadAddBookForm(mainContent);
                break;
            case 'listBooks':
                loadListBooks(mainContent);
                break;
            case 'issueBook':
                loadIssueBookForm(mainContent);
                break;
            case 'listIssuedBooks':
                loadListIssuedBooks(mainContent);
                break;
            case 'returnBooksToday':
                loadBooksToBeReturnedToday(mainContent);
                break;

        }
    }
    function loadManageUsers(mainContent) {
    // Example data for demonstration
    var users = [
        { id: 1, name: "John Doe", email: "john.doe@example.com", phone: "123-456-7890" },
        { id: 2, name: "Jane Smith", email: "jane.smith@example.com", phone: "987-654-3210" }
        // Add more users as needed
    ];

    mainContent.innerHTML = `
        <div class="container">
            <h2>Manage Users</h2>
            <button class="form-button" onclick="addNewUser()">Add New User</button>
            <table class="results-table" id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Date Of Birth</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    ${generateUsersTable(users)}
                </tbody>
            </table>
        </div>
    `;
}

function generateUsersTable(users) {
    return users.map(user => `
        <tr>
            <td>${user.id}</td>
            <td>${user.name}</td>
            <td>${user.emailAddress}</td>
            <td>${user.phoneNumber}</td>
            <td>${user.dateOfBirth}</td>
            <td>
                <button class="small-button" onclick="editUser(${user.id})">Edit</button>
                <button class="small-button" onclick="deleteUser(${user.id})">Delete</button>
            </td>
        </tr>
    `).join('');
}

function addNewUser() {
    // HTML markup for the form to add a new user
    mainContent.innerHTML = `
        <div class="container">
            <h2>Add New User</h2>
            <form id="addUserForm" method="post" action="/admin/users/add">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required><br>

                <label for="idNumber">ID Number:</label>
                <input type="text" id="idNumber" name="idNumber" required><br>

                <label for="dateOfBirth">Date of Birth:</label>
                <input type="date" id="dateOfBirth" name="dateOfBirth" required><br>

                <label for="address">Address:</label>
                <input type="text" id="address" name="address" required><br>

                <label for="phoneNumber">Phone Number:</label>
                <input type="text" id="phoneNumber" name="phoneNumber" required><br>

                <label for="emailAddress">Email Address:</label>
                <input type="email" id="emailAddress" name="emailAddress" required><br>

                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required><br>

                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required><br>

                <label for="confirmPassword">Confirm Password:</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required><br>

                <label for="role">Role:</label>
                <input type="text" id="role" name="role" required><br>

                <button type="submit" class="form-button">Add User</button>
            </form>
        </div>
    `;

    // Handle form submission
    document.getElementById('addUserForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        // Gather form data
        var formData = new FormData(event.target);

        // Send POST request to add user
        fetch(event.target.action, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // Reload manage users page after successful addition
                loadManageUsers(document.getElementById('main-content'));
            } else {
                throw new Error('Failed to add user.');
            }
        })
        .catch(error => {
            console.error('Error adding user:', error);
            alert('Failed to add user. Please try again.');
        });
    });
}


function editUser(userId) {
    // Implement logic to edit a user
    alert("Functionality to edit user with ID: " + userId);
}

function deleteUser(userId) {
    // Implement logic to delete a user
    alert("Functionality to delete user with ID: " + userId);
}


    function loadAddBookForm(mainContent) {
        var categories = ["Fiction", "Non-fiction", "Science Fiction", "Fantasy", "Mystery", "Romance"];
        var categoryOptions = categories.map(function(category) {
            return `<option value="${category}">${category}</option>`;
        }).join('');


        mainContent.innerHTML = `
            <div class="container">
                <h2>Add a Book</h2>
                <form id="addBookForm" method="post" action="/admin/books/add">
                <label class="form-label" for="title">Title:</label>
                <input type="text" id="title" name="title" class="form-input" required><br>

                <label class="form-label" for="isbn">ISBN (Book Number):</label>
                <input type="text" id="isbn" name="isbn" class="form-input" required><br>

                <label class="form-label" for="category">Category:</label>
                <select id="category" name="category" class="form-select" required>
                    <option value="" disabled selected>Select or enter a category</option>
                    <option value="new">Add New</option>
                    ${categoryOptions}
                </select><br>

                <div id="newCategoryInput" style="display: none;">
                    <label class="form-label" for="newCategory">New Category:</label>
                    <input type="text" id="newCategory" name="newCategory" class="form-input" placeholder="Enter New Category"><br>
                </div>

                <label class="form-label" for="author">Author Name:</label>
                <input type="text" id="author" name="author" class="form-input" required><br>

                <label class="form-label" for="quantity">Number of Copies:</label>
                <input type="text" id="quantity" name="quantity" class="form-input" required><br>

                <button type="submit" class="form-button">Add Book</button>
            </form>

            </div>
        `;

        document.getElementById("category").addEventListener("change", function() {
        var newCategoryInput = document.getElementById("newCategoryInput");
        newCategoryInput.style.display = this.value === "new" ? "block" : "none";
    });

    document.getElementById("addBookForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent form submission

        var title = document.getElementById("title").value;
        var isbn = document.getElementById("isbn").value;
        var category = document.getElementById("category").value;
        if (category === "new") {
            category = document.getElementById("newCategory").value;
        }
        var author = document.getElementById("author").value;
        var quantity = document.getElementById("quantity").value;

        // Create a form object to send the data
        var formData = new FormData();
        formData.append("title", title);
        formData.append("isbn", isbn);
        formData.append("category", category);
        formData.append("author", author);
        formData.append("quantity", quantity);

        fetch("/admin/books/add", {
            method: "POST",
            body: formData
        }).then(response => {
            if (response.ok) {
                mainContent.innerHTML = "<h2>Book Added Successfully</h2>";
            } else {
                alert("Error adding book.");
            }
        }).catch(error => {
            console.error("Error:", error);
            alert("Error adding book.");
        });
    });
}

    function loadListBooks(mainContent) {
        mainContent.innerHTML = `
            <div class="container">
             <form action="#" th:action="@{/searchBooks}" method="get">
                <h2>List of Books</h2>
                <div class="search-container">
                    <input type="text" id="searchBooksInput" class="form-input" placeholder="Search by title or author">
                    <button class="form-button" onclick="searchBooks()">Search</button>
                </div>
             </form>
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Book ISBN</th>
                            <th>Book Title</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Author</th>
                         </tr>
        </thead>
        <tbody>
        <tr th:each="book : ${books}">
            <td th:text="${book.isbn}">ISBN</td>
            <td th:text="${book.title}">Title</td>
            <td th:text="${book.category}">Category</td>
            <td th:text="${book.author}">Author</td>
            <td th:text="${book.quantity}">Quantity</td>
            <td>
                <button type="button" onclick="editBook('${book.isbn}')">Edit</button>
                <button type="button" onclick="deleteBook('${book.isbn}')">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>

            </div>
        `;
    }




    function loadIssueBookForm(mainContent) {
        mainContent.innerHTML = `
            <div class="container" style="position: relative;">
                <h2>Issue Book</h2>

                <div class="search-container">
                    <label for="searchBookInput" style="display: inline-block; width: 100px;">Search for Book:</label>
                    <input type="text" id="searchBookInput" class="form-input" style="width: 200px; margin-right: 10px;" placeholder="Search by title or ISBN">
                    <select id="searchBookSelect" class="form-select" style="width: 150px;">
                        <option value="title">Title</option>
                        <option value="isbn">ISBN</option>
                    </select>
                    <button class="form-button" style="margin-left: 10px;">Search</button>
                </div>
                <table class="results-table" id="searchResultsBooks">
                    <thead>
                        <tr>
                            <th>Book ISBN</th>
                            <th>Book Title</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Author</th>
                        </tr>
                    </thead>
                    <tbody id="searchResultsBooksBody">
                    </tbody>
                </table>

                <div class="search-container" style="margin-top: 20px;">
                    <label for="searchMemberInput" style="display: inline-block; width: 120px;">Search for Member:</label>
                    <input type="text" id="searchMemberInput" class="form-input" style="width: 200px; margin-right: 10px;" placeholder="Search by name or ID">
                    <button class="form-button">Search</button>
                    <button class="form-button" style="margin-left: 10px;" onclick="addMember()">Add Member</button>
                </div>
                <table class="results-table" id="searchResultsMembers">
                    <thead>
                        <tr>
                            <th>Member ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                        </tr>
                    </thead>
                    <tbody id="searchResultsMembersBody">
                    </tbody>
                </table>

                <!-- Place the Issue Book button below the tables -->
                <div class="issue-book-button-container">
                    <button class="form-button" onclick="issueBook()">Issue Book</button>
                </div>
            </div>
        `;
    }

    function loadListIssuedBooks(mainContent) {
        var issuedBooks = books.filter(book => book.quantity < 1); // Filter books with quantity less than 1 (issued books)

        mainContent.innerHTML = `
            <div class="container">
                <h2>List Issued Books</h2>
                <table class="results-table" id="resultsTable">
                    <thead>
                        <tr>
                            <th>Book ISBN</th>
                            <th>Book Title</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Author</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${generateBooksTable(issuedBooks)}
                    </tbody>
                </table>
            </div>
        `;
    }

    function loadBooksToBeReturnedToday(mainContent) {
        mainContent.innerHTML = `
            <div class="container">
                <h2>Books to be Returned Today</h2>
                <div class="search-container" style="margin-bottom: 20px;">
                    <label for="usnInput" style="display: inline-block; width: 100px;">USN:</label>
                    <input type="text" id="usnInput" class="form-input" style="width: 200px; margin-right: 10px;" placeholder="Enter USN">
                    <button class="form-button" onclick="searchBooksToBeReturnedToday()">Search</button>
                </div>
                <table class="results-table" id="returnBooksTodayTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>USN</th>
                            <th>Member ID</th>
                            <th>Issue Date</th>
                            <th>Return Date</th>
                            <th>ISBN</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Sample data, should be dynamically generated -->
                        <tr>
                            <td>1</td>
                            <td>USN123</td>
                            <td>Member1</td>
                            <td>2024-06-01</td>
                            <td>2024-06-24</td>
                            <td>123456</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>USN456</td>
                            <td>Member2</td>
                            <td>2024-06-05</td>
                            <td>2024-06-24</td>
                            <td>789012</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;
    }

    function searchBooks() {
        var keyword = document.getElementById("searchBooksInput").value.trim().toLowerCase();
        var resultsTable = document.getElementById("resultsTable").getElementsByTagName('tbody')[0];

        resultsTable.innerHTML = "";
        var results = books.filter(book =>
            book.title.toLowerCase().includes(keyword) || book.author.toLowerCase().includes(keyword)
        );
        results.forEach(function(book) {
            var row = resultsTable.insertRow();
            row.insertCell(0).innerText = book.isbn;
            row.insertCell(1).innerText = book.title;
            row.insertCell(2).innerText = book.category;
            row.insertCell(3).innerText = book.quantity;
            row.insertCell(4).innerText = book.author;
        });
    }

    function generateBooksTable(books) {
        return books.map(book => `
            <tr>
                <td>${book.isbn}</td>
                <td>${book.title}</td>
                <td>${book.category}</td>
                <td>${book.quantity}</td>
                <td>${book.author}</td>
            </tr>
        `).join('');
    }

    function searchBooksToBeReturnedToday() {
        var usn = document.getElementById("usnInput").value.trim().toLowerCase();
        var returnBooksTodayTable = document.getElementById("returnBooksTodayTable").getElementsByTagName("tbody")[0];

        // Sample data for books to be returned today
        var booksToBeReturnedToday = [
            { id: 1, usn: "USN123", memberId: "Member1", issueDate: "2024-06-01", returnDate: "2024-06-24", isbn: "123456" },
            { id: 2, usn: "USN456", memberId: "Member2", issueDate: "2024-06-05", returnDate: "2024-06-24", isbn: "789012" }
        ];

        var filteredBooks = booksToBeReturnedToday.filter(book => book.usn.toLowerCase().includes(usn));
        returnBooksTodayTable.innerHTML = filteredBooks.map(book => `
            <tr>
                <td>${book.id}</td>
                <td>${book.usn}</td>
                <td>${book.memberId}</td>
                <td>${book.issueDate}</td>
                <td>${book.returnDate}</td>
                <td>${book.isbn}</td>
            </tr>
        `).join('');
    }

</script>

</body>
</html>
